<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Authentication System</title>-->
<!--    <style>-->
<!--        * {-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            box-sizing: border-box;-->
<!--        }-->

<!--        :root {-->
<!--            &#45;&#45;primary: #3b82f6;-->
<!--            &#45;&#45;primary-dark: #1e40af;-->
<!--            &#45;&#45;primary-light: #eff6ff;-->
<!--            &#45;&#45;success: #10b981;-->
<!--            &#45;&#45;danger: #ef4444;-->
<!--            &#45;&#45;warning: #f59e0b;-->
<!--            &#45;&#45;gray-50: #f9fafb;-->
<!--            &#45;&#45;gray-100: #f3f4f6;-->
<!--            &#45;&#45;gray-200: #e5e7eb;-->
<!--            &#45;&#45;gray-600: #4b5563;-->
<!--            &#45;&#45;gray-700: #374151;-->
<!--            &#45;&#45;gray-900: #111827;-->
<!--            &#45;&#45;shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);-->
<!--            &#45;&#45;shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.1);-->
<!--        }-->

<!--        body {-->
<!--            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',-->
<!--            'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',-->
<!--            sans-serif;-->
<!--            background: linear-gradient(135deg, var(&#45;&#45;primary-light) 0%, #f3f4f6 100%);-->
<!--            min-height: 100vh;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            justify-content: center;-->
<!--            color: var(&#45;&#45;gray-900);-->
<!--        }-->

<!--        .container {-->
<!--            width: 100%;-->
<!--            max-width: 450px;-->
<!--            padding: 20px;-->
<!--        }-->

<!--        .card {-->
<!--            background: white;-->
<!--            border-radius: 12px;-->
<!--            box-shadow: var(&#45;&#45;shadow-lg);-->
<!--            padding: 40px;-->
<!--            transition: all 0.3s ease;-->
<!--        }-->

<!--        .card:hover {-->
<!--            box-shadow: 0 20px 35px -5px rgba(0, 0, 0, 0.15);-->
<!--        }-->

<!--        .header {-->
<!--            text-align: center;-->
<!--            margin-bottom: 30px;-->
<!--        }-->

<!--        .header h1 {-->
<!--            font-size: 28px;-->
<!--            font-weight: 700;-->
<!--            margin-bottom: 8px;-->
<!--            color: var(&#45;&#45;gray-900);-->
<!--        }-->

<!--        .header p {-->
<!--            color: var(&#45;&#45;gray-600);-->
<!--            font-size: 14px;-->
<!--        }-->

<!--        .form-group {-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        label {-->
<!--            display: block;-->
<!--            margin-bottom: 8px;-->
<!--            font-weight: 500;-->
<!--            font-size: 14px;-->
<!--            color: var(&#45;&#45;gray-700);-->
<!--        }-->

<!--        input, select {-->
<!--            width: 100%;-->
<!--            padding: 12px 14px;-->
<!--            border: 1.5px solid var(&#45;&#45;gray-200);-->
<!--            border-radius: 8px;-->
<!--            font-size: 14px;-->
<!--            transition: all 0.3s ease;-->
<!--            background: var(&#45;&#45;gray-50);-->
<!--        }-->

<!--        input:focus, select:focus {-->
<!--            outline: none;-->
<!--            border-color: var(&#45;&#45;primary);-->
<!--            background: white;-->
<!--            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);-->
<!--        }-->

<!--        input.error {-->
<!--            border-color: var(&#45;&#45;danger);-->
<!--            background: rgba(239, 68, 68, 0.05);-->
<!--        }-->

<!--        .error-message {-->
<!--            color: var(&#45;&#45;danger);-->
<!--            font-size: 13px;-->
<!--            margin-top: 6px;-->
<!--            display: none;-->
<!--        }-->

<!--        .error-message.show {-->
<!--            display: block;-->
<!--        }-->

<!--        .btn {-->
<!--            width: 100%;-->
<!--            padding: 12px 16px;-->
<!--            border: none;-->
<!--            border-radius: 8px;-->
<!--            font-weight: 600;-->
<!--            font-size: 14px;-->
<!--            cursor: pointer;-->
<!--            transition: all 0.3s ease;-->
<!--            text-transform: uppercase;-->
<!--            letter-spacing: 0.5px;-->
<!--        }-->

<!--        .btn-primary {-->
<!--            background: var(&#45;&#45;primary);-->
<!--            color: white;-->
<!--        }-->

<!--        .btn-primary:hover:not(:disabled) {-->
<!--            background: var(&#45;&#45;primary-dark);-->
<!--            transform: translateY(-2px);-->
<!--            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);-->
<!--        }-->

<!--        .btn-primary:disabled {-->
<!--            opacity: 0.6;-->
<!--            cursor: not-allowed;-->
<!--        }-->

<!--        .btn-secondary {-->
<!--            background: var(&#45;&#45;gray-100);-->
<!--            color: var(&#45;&#45;gray-900);-->
<!--            margin-top: 12px;-->
<!--        }-->

<!--        .btn-secondary:hover {-->
<!--            background: var(&#45;&#45;gray-200);-->
<!--        }-->

<!--        .toggle-link {-->
<!--            text-align: center;-->
<!--            margin-top: 20px;-->
<!--            font-size: 14px;-->
<!--            color: var(&#45;&#45;gray-600);-->
<!--        }-->

<!--        .toggle-link a {-->
<!--            color: var(&#45;&#45;primary);-->
<!--            text-decoration: none;-->
<!--            font-weight: 600;-->
<!--            cursor: pointer;-->
<!--        }-->

<!--        .toggle-link a:hover {-->
<!--            text-decoration: underline;-->
<!--        }-->

<!--        .alert {-->
<!--            padding: 14px 16px;-->
<!--            border-radius: 8px;-->
<!--            margin-bottom: 20px;-->
<!--            font-size: 14px;-->
<!--            display: none;-->
<!--        }-->

<!--        .alert.show {-->
<!--            display: block;-->
<!--        }-->

<!--        .alert-success {-->
<!--            background: rgba(16, 185, 129, 0.1);-->
<!--            color: var(&#45;&#45;success);-->
<!--            border-left: 4px solid var(&#45;&#45;success);-->
<!--        }-->

<!--        .alert-error {-->
<!--            background: rgba(239, 68, 68, 0.1);-->
<!--            color: var(&#45;&#45;danger);-->
<!--            border-left: 4px solid var(&#45;&#45;danger);-->
<!--        }-->

<!--        .alert-warning {-->
<!--            background: rgba(245, 158, 11, 0.1);-->
<!--            color: var(&#45;&#45;warning);-->
<!--            border-left: 4px solid var(&#45;&#45;warning);-->
<!--        }-->

<!--        .form-row {-->
<!--            display: grid;-->
<!--            grid-template-columns: 1fr 1fr;-->
<!--            gap: 20px;-->
<!--        }-->

<!--        .hidden {-->
<!--            display: none;-->
<!--        }-->

<!--        .loading {-->
<!--            opacity: 0.7;-->
<!--            pointer-events: none;-->
<!--        }-->

<!--        .spinner {-->
<!--            display: inline-block;-->
<!--            width: 14px;-->
<!--            height: 14px;-->
<!--            border: 2px solid rgba(255, 255, 255, 0.3);-->
<!--            border-radius: 50%;-->
<!--            border-top-color: white;-->
<!--            animation: spin 0.8s linear infinite;-->
<!--        }-->

<!--        @keyframes spin {-->
<!--            to {-->
<!--                transform: rotate(360deg);-->
<!--            }-->
<!--        }-->

<!--        .divider {-->
<!--            text-align: center;-->
<!--            margin: 24px 0;-->
<!--            /*color: var(&#45;&#45;gray-400);*/-->
<!--            font-size: 12px;-->
<!--            text-transform: uppercase;-->
<!--        }-->

<!--        .divider::before,-->
<!--        .divider::after {-->
<!--            content: '';-->
<!--            display: inline-block;-->
<!--            width: 40%;-->
<!--            height: 1px;-->
<!--            background: var(&#45;&#45;gray-200);-->
<!--            vertical-align: middle;-->
<!--        }-->

<!--        .divider::before {-->
<!--            margin-right: 12px;-->
<!--        }-->

<!--        .divider::after {-->
<!--            margin-left: 12px;-->
<!--        }-->

<!--        .user-info {-->
<!--            background: var(&#45;&#45;primary-light);-->
<!--            border: 1.5px solid var(&#45;&#45;primary);-->
<!--            border-radius: 8px;-->
<!--            padding: 20px;-->
<!--            margin-bottom: 20px;-->
<!--        }-->

<!--        .user-info h3 {-->
<!--            font-size: 16px;-->
<!--            margin-bottom: 12px;-->
<!--            color: var(&#45;&#45;primary-dark);-->
<!--        }-->

<!--        .user-info p {-->
<!--            font-size: 13px;-->
<!--            margin-bottom: 6px;-->
<!--            color: var(&#45;&#45;gray-700);-->
<!--        }-->

<!--        .user-info strong {-->
<!--            color: var(&#45;&#45;gray-900);-->
<!--        }-->

<!--        @media (max-width: 480px) {-->
<!--            .card {-->
<!--                padding: 24px;-->
<!--            }-->

<!--            .form-row {-->
<!--                grid-template-columns: 1fr;-->
<!--            }-->

<!--            .header h1 {-->
<!--                font-size: 24px;-->
<!--            }-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--    <div class="card">-->
<!--        &lt;!&ndash; Alert Messages &ndash;&gt;-->
<!--        <div class="alert alert-success" id="successAlert"></div>-->
<!--        <div class="alert alert-error" id="errorAlert"></div>-->
<!--        <div class="alert alert-warning" id="warningAlert"></div>-->

<!--        &lt;!&ndash; Login Form &ndash;&gt;-->
<!--        <div id="loginForm" class="form-section">-->
<!--            <div class="header">-->
<!--                <h1>Welcome Back</h1>-->
<!--                <p>Sign in to your account</p>-->
<!--            </div>-->

<!--            <form id="loginFormElement" onsubmit="handleLogin(event)">-->
<!--                <div class="form-group">-->
<!--                    <label for="loginEmail">Email Address</label>-->
<!--                    <input type="email" id="loginEmail" placeholder="you@example.com" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="loginPassword">Password</label>-->
<!--                    <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Sign In</button>-->
<!--            </form>-->

<!--            <div class="divider">Or</div>-->

<!--            <div class="toggle-link">-->
<!--                Don't have an account? <a onclick="toggleForms('signup')">Sign up</a>-->
<!--            </div>-->
<!--            <div class="toggle-link">-->
<!--                <a onclick="toggleForms('forgot')">Forgot your password?</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Signup Form &ndash;&gt;-->
<!--        <div id="signupForm" class="form-section hidden">-->
<!--            <div class="header">-->
<!--                <h1>Create Account</h1>-->
<!--                <p>Join us today</p>-->
<!--            </div>-->

<!--            <form id="signupFormElement" onsubmit="handleSignup(event)">-->
<!--                <div class="form-row">-->
<!--                    <div class="form-group">-->
<!--                        <label for="signupName">First Name</label>-->
<!--                        <input type="text" id="signupName" placeholder="John" required>-->
<!--                        <div class="error-message"></div>-->
<!--                    </div>-->
<!--                    <div class="form-group">-->
<!--                        <label for="signupSurname">Last Name</label>-->
<!--                        <input type="text" id="signupSurname" placeholder="Doe" required>-->
<!--                        <div class="error-message"></div>-->
<!--                    </div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupEmail">Email Address</label>-->
<!--                    <input type="email" id="signupEmail" placeholder="you@example.com" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupPassword">Password</label>-->
<!--                    <input type="password" id="signupPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupConfirmPassword">Confirm Password</label>-->
<!--                    <input type="password" id="signupConfirmPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupAddress">Address (Optional)</label>-->
<!--                    <input type="text" id="signupAddress" placeholder="123 Main St">-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupSalary">Salary (Optional)</label>-->
<!--                    <input type="number" id="signupSalary" placeholder="50000" step="0.01">-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="signupDepartment">Department ID (Optional)</label>-->
<!--                    <input type="number" id="signupDepartment" placeholder="1">-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Create Account</button>-->
<!--            </form>-->

<!--            <div class="toggle-link">-->
<!--                Already have an account? <a onclick="toggleForms('login')">Sign in</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Forgot Password Form &ndash;&gt;-->
<!--        <div id="forgotForm" class="form-section hidden">-->
<!--            <div class="header">-->
<!--                <h1>Reset Password</h1>-->
<!--                <p>Enter your email to receive a reset link</p>-->
<!--            </div>-->

<!--            <form id="forgotFormElement" onsubmit="handleForgotPassword(event)">-->
<!--                <div class="form-group">-->
<!--                    <label for="forgotEmail">Email Address</label>-->
<!--                    <input type="email" id="forgotEmail" placeholder="you@example.com" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Send Reset Link</button>-->
<!--            </form>-->

<!--            <div class="divider">Or</div>-->

<!--            <div class="toggle-link">-->
<!--                <a onclick="toggleForms('login')">Back to sign in</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Reset Password Form &ndash;&gt;-->
<!--        <div id="resetForm" class="form-section hidden">-->
<!--            <div class="header">-->
<!--                <h1>Create New Password</h1>-->
<!--                <p>Enter your new password</p>-->
<!--            </div>-->

<!--            <form id="resetFormElement" onsubmit="handleResetPassword(event)">-->

<!--                <div class="form-group">-->
<!--                    <label for="resetPassword">New Password</label>-->
<!--                    <input type="password" id="resetPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="resetConfirmPassword">Confirm Password</label>-->
<!--                    <input type="password" id="resetConfirmPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Reset Password</button>-->
<!--            </form>-->

<!--            <div class="toggle-link">-->
<!--                <a onclick="toggleForms('login')">Back to sign in</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Verification Form &ndash;&gt;-->
<!--        <div id="verificationForm" class="form-section hidden">-->
<!--            <div class="header">-->
<!--                <h1>Verify Email</h1>-->
<!--                <p>Confirm your email address</p>-->
<!--            </div>-->

<!--            <form id="verificationFormElement" onsubmit="handleSendVerification(event)">-->
<!--                <div class="form-group">-->
<!--                    <label for="verificationEmail">Email Address</label>-->
<!--                    <input type="email" id="verificationEmail" placeholder="you@example.com" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Send Verification Link</button>-->
<!--            </form>-->

<!--            <div class="divider">Or</div>-->

<!--            <div class="toggle-link">-->
<!--                <a onclick="toggleForms('login')">Back to sign in</a>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Dashboard &ndash;&gt;-->
<!--        <div id="dashboard" class="form-section hidden">-->
<!--            <div class="header">-->
<!--                <h1>Dashboard</h1>-->
<!--                <p>Welcome to your account</p>-->
<!--            </div>-->

<!--            <div class="user-info" id="userInfoDisplay"></div>-->

<!--            <form id="changePasswordForm" onsubmit="handleChangePassword(event)">-->
<!--                <div class="form-group">-->
<!--                    <label for="oldPassword">Current Password</label>-->
<!--                    <input type="password" id="oldPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="newPassword">New Password</label>-->
<!--                    <input type="password" id="newPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <div class="form-group">-->
<!--                    <label for="confirmPassword">Confirm New Password</label>-->
<!--                    <input type="password" id="confirmPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>-->
<!--                    <div class="error-message"></div>-->
<!--                </div>-->

<!--                <button type="submit" class="btn btn-primary">Change Password</button>-->
<!--            </form>-->

<!--            <button type="button" class="btn btn-secondary" onclick="handleLogout()">Logout</button>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<script>-->
<!--    const API_BASE_URL = 'http://localhost:8080/api/v1/auth';-->
<!--    let resetTokenFromUrl = null;-->


<!--    // Utility functions-->
<!--    function showAlert(type, message) {-->
<!--        const alert = document.getElementById(`${type}Alert`);-->
<!--        alert.textContent = message;-->
<!--        alert.classList.add('show');-->
<!--        setTimeout(() => alert.classList.remove('show'), 5000);-->
<!--    }-->

<!--    // function toggleForms(formName) {-->
<!--    //     document.querySelectorAll('.form-section').forEach(el => el.classList.add('hidden'));-->
<!--    //     document.getElementById(formName + 'Form').classList.remove('hidden');-->
<!--    //     clearAllErrors();-->
<!--    //     clearAllAlerts();-->
<!--    // }-->
<!--    // function toggleForms(formName) {-->
<!--    //     document.querySelectorAll('.form-section').forEach(el => el.classList.add('hidden'));-->
<!--    //-->
<!--    //     if (formName === 'dashboard') {-->
<!--    //         document.getElementById('dashboard').classList.remove('hidden');-->
<!--    //     } else {-->
<!--    //         document.getElementById(formName + 'Form').classList.remove('hidden');-->
<!--    //     }-->
<!--    //-->
<!--    //     clearAllErrors();-->
<!--    //     clearAllAlerts();-->
<!--    // }-->
<!--    function toggleForms(formName) {-->
<!--        document.querySelectorAll('.form-section').forEach(el => el.classList.add('hidden'));-->

<!--        if (formName === 'dashboard') {-->
<!--            document.getElementById('dashboard').classList.remove('hidden');-->
<!--        } else if (formName === 'reset') {-->
<!--            document.getElementById('resetForm').classList.remove('hidden'); // ðŸ”¹ Burda resetForm aÃ§Ä±lÄ±r-->
<!--        } else {-->
<!--            document.getElementById(formName + 'Form').classList.remove('hidden');-->
<!--        }-->

<!--        clearAllErrors();-->
<!--        clearAllAlerts();-->
<!--    }-->



<!--    function clearAllErrors() {-->
<!--        document.querySelectorAll('.error-message').forEach(el => {-->
<!--            el.classList.remove('show');-->
<!--            el.textContent = '';-->
<!--        });-->
<!--        document.querySelectorAll('input').forEach(el => el.classList.remove('error'));-->
<!--    }-->

<!--    function clearAllAlerts() {-->
<!--        document.querySelectorAll('.alert').forEach(el => el.classList.remove('show'));-->
<!--    }-->

<!--    function showFieldError(fieldId, message) {-->
<!--        const input = document.getElementById(fieldId);-->
<!--        const errorEl = input.closest('.form-group').querySelector('.error-message');-->
<!--        if (errorEl) {-->
<!--            errorEl.textContent = message;-->
<!--            errorEl.classList.add('show');-->
<!--            input.classList.add('error');-->
<!--        }-->
<!--    }-->

<!--    function setButtonLoading(button, isLoading) {-->
<!--        const originalText = button.dataset.originalText || button.textContent;-->
<!--        button.dataset.originalText = originalText;-->

<!--        if (isLoading) {-->
<!--            button.disabled = true;-->
<!--            button.innerHTML = `<span class="spinner"></span> Loading...`;-->
<!--        } else {-->
<!--            button.disabled = false;-->
<!--            button.textContent = originalText;-->
<!--        }-->
<!--    }-->

<!--    function validateEmail(email) {-->
<!--        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);-->
<!--    }-->

<!--    function validatePassword(password) {-->
<!--        return password.length >= 6;-->
<!--    }-->

<!--    // API calls-->
<!--    async function apiCall(endpoint, method = 'POST', data = null) {-->
<!--        try {-->
<!--            const options = {-->
<!--                method,-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                    'Authorization': `Bearer ${localStorage.getItem('accessToken') || ''}`-->
<!--                }-->
<!--            };-->

<!--            if (data) {-->
<!--                options.body = JSON.stringify(data);-->
<!--            }-->

<!--            const response = await fetch(`${API_BASE_URL}${endpoint}`, options);-->
<!--            const responseData = await response.json();-->

<!--            if (!response.ok) {-->
<!--                throw new Error(responseData.message || responseData.error || 'An error occurred');-->
<!--            }-->

<!--            return responseData;-->
<!--        } catch (error) {-->
<!--            throw error;-->
<!--        }-->
<!--    }-->

<!--    // Form handlers-->
<!--    async function handleLogin(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const email = document.getElementById('loginEmail').value;-->
<!--        const password = document.getElementById('loginPassword').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        if (!validateEmail(email)) {-->
<!--            showFieldError('loginEmail', 'Please enter a valid email');-->
<!--            return;-->
<!--        }-->

<!--        if (!validatePassword(password)) {-->
<!--            showFieldError('loginPassword', 'Password must be at least 6 characters');-->
<!--            return;-->
<!--        }-->

<!--        setButtonLoading(button, true);-->

<!--        try {-->
<!--            const response = await apiCall('/login', 'POST', { email, password });-->
<!--            localStorage.setItem('accessToken', response.accessToken);-->
<!--            localStorage.setItem('refreshToken', response.token);-->

<!--            showAlert('success', 'Login successful!');-->
<!--            setTimeout(() => {-->
<!--                toggleForms('dashboard');-->
<!--                displayUserInfo();-->
<!--            }, 1000);-->
<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->

<!--    async function handleSignup(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const name = document.getElementById('signupName').value;-->
<!--        const surname = document.getElementById('signupSurname').value;-->
<!--        const email = document.getElementById('signupEmail').value;-->
<!--        const password = document.getElementById('signupPassword').value;-->
<!--        const confirmPassword = document.getElementById('signupConfirmPassword').value;-->
<!--        const address = document.getElementById('signupAddress').value;-->
<!--        const salary = document.getElementById('signupSalary').value;-->
<!--        const departmentId = document.getElementById('signupDepartment').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        let hasError = false;-->

<!--        if (!name.trim()) {-->
<!--            showFieldError('signupName', 'First name is required');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (!surname.trim()) {-->
<!--            showFieldError('signupSurname', 'Last name is required');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (!validateEmail(email)) {-->
<!--            showFieldError('signupEmail', 'Please enter a valid email');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (!validatePassword(password)) {-->
<!--            showFieldError('signupPassword', 'Password must be at least 6 characters');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (password !== confirmPassword) {-->
<!--            showFieldError('signupConfirmPassword', 'Passwords do not match');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (hasError) return;-->

<!--        setButtonLoading(button, true);-->

<!--        try {-->
<!--            const payload = {-->
<!--                name,-->
<!--                surname,-->
<!--                email,-->
<!--                password,-->
<!--                departmentId: departmentId ? parseInt(departmentId) : null-->
<!--            };-->

<!--            if (address) payload.address = address;-->
<!--            if (salary) payload.salary = parseFloat(salary);-->

<!--            const response = await apiCall('/signUp', 'POST', payload);-->

<!--            showAlert('success', 'Account created! Please verify your email.');-->
<!--            setTimeout(() => {-->
<!--                document.getElementById('signupFormElement').reset();-->
<!--                toggleForms('verification');-->
<!--            }, 1000);-->
<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->
<!--    async function handleForgotPassword(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const email = document.getElementById('forgotEmail').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        if (!validateEmail(email)) {-->
<!--            showFieldError('forgotEmail', 'Email dÃ¼zgÃ¼n deyil');-->
<!--            return;-->
<!--        }-->

<!--        setButtonLoading(button, true);-->

<!--        try {-->
<!--            await apiCall('/forgotPassword', 'POST', { email });-->

<!--            showAlert(-->
<!--                'success',-->
<!--                'Reset link email Ã¼nvanÄ±na gÃ¶ndÉ™rildi. ZÉ™hmÉ™t olmasa emailinizi yoxlayÄ±n.'-->
<!--            );-->

<!--            // âœ… BURADA reset formu aÃ§Ä±lmÄ±r-->
<!--            setTimeout(() => {-->
<!--                document.getElementById('forgotFormElement').reset();-->
<!--                toggleForms('login'); // vÉ™ ya elÉ™ forgot sÉ™hifÉ™sindÉ™ qalsÄ±n-->
<!--            }, 1500);-->

<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->

<!--    // async function handleForgotPassword(event) {-->
<!--    //     event.preventDefault();-->
<!--    //     clearAllErrors();-->
<!--    //-->
<!--    //     const email = document.getElementById('forgotEmail').value;-->
<!--    //     const button = event.target.querySelector('button');-->
<!--    //-->
<!--    //     if (!validateEmail(email)) {-->
<!--    //         showFieldError('forgotEmail', 'Please enter a valid email');-->
<!--    //         return;-->
<!--    //     }-->
<!--    //-->
<!--    //     setButtonLoading(button, true);-->
<!--    //-->
<!--    //     try {-->
<!--    //         const response = await apiCall('/forgotPassword', 'POST', { email });-->
<!--    //         showAlert('success', 'Reset link sent to your email!');-->
<!--    //         setTimeout(() => {-->
<!--    //             document.getElementById('forgotFormElement').reset();-->
<!--    //             toggleForms('reset');-->
<!--    //         }, 1000);-->
<!--    //     } catch (error) {-->
<!--    //         showAlert('error', error.message);-->
<!--    //     } finally {-->
<!--    //         setButtonLoading(button, false);-->
<!--    //     }-->
<!--    // }-->

<!--    async function handleResetPassword(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const password = document.getElementById('resetPassword').value;-->
<!--        const confirmPassword = document.getElementById('resetConfirmPassword').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        if (!resetTokenFromUrl) {-->
<!--            showAlert('error', 'Reset link is invalid or expired');-->
<!--            return;-->
<!--        }-->

<!--        if (!validatePassword(password)) {-->
<!--            showFieldError('resetPassword', 'Password must be at least 6 characters');-->
<!--            return;-->
<!--        }-->

<!--        if (password !== confirmPassword) {-->
<!--            showFieldError('resetConfirmPassword', 'Passwords do not match');-->
<!--            return;-->
<!--        }-->

<!--        setButtonLoading(button, true);-->


<!--        try {-->
<!--            await apiCall(`/resetPassword?token=${resetTokenFromUrl}`, 'POST', {-->
<!--                newPassword: password,-->
<!--                confirmPassword: confirmPassword-->
<!--            });-->

<!--            showAlert('success', 'Password reset successfully!');-->
<!--            setTimeout(() => toggleForms('login'), 1000);-->
<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->



<!--    async function handleSendVerification(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const email = document.getElementById('verificationEmail').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        if (!validateEmail(email)) {-->
<!--            showFieldError('verificationEmail', 'Please enter a valid email');-->
<!--            return;-->
<!--        }-->

<!--        setButtonLoading(button, true);-->

<!--        try {-->
<!--            const response = await apiCall('/send-verification-link', 'POST', { email });-->
<!--            showAlert('success', 'Verification link sent! Check your email.');-->
<!--            setTimeout(() => {-->
<!--                document.getElementById('verificationFormElement').reset();-->
<!--                toggleForms('login');-->
<!--            }, 2000);-->
<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->

<!--    async function handleChangePassword(event) {-->
<!--        event.preventDefault();-->
<!--        clearAllErrors();-->

<!--        const oldPassword = document.getElementById('oldPassword').value;-->
<!--        const newPassword = document.getElementById('newPassword').value;-->
<!--        const confirmPassword = document.getElementById('confirmPassword').value;-->
<!--        const button = event.target.querySelector('button');-->

<!--        let hasError = false;-->

<!--        if (!validatePassword(oldPassword)) {-->
<!--            showFieldError('oldPassword', 'Old password is required');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (!validatePassword(newPassword)) {-->
<!--            showFieldError('newPassword', 'New password must be at least 6 characters');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (newPassword !== confirmPassword) {-->
<!--            showFieldError('confirmPassword', 'Passwords do not match');-->
<!--            hasError = true;-->
<!--        }-->

<!--        if (hasError) return;-->

<!--        setButtonLoading(button, true);-->

<!--        try {-->
<!--            const response = await apiCall('/changePassword', 'PUT' +-->
<!--                '', {-->
<!--                oldPassword,-->
<!--                newPassword,-->
<!--                confirmPassword-->
<!--            });-->

<!--            showAlert('success', 'Password changed successfully!');-->
<!--            document.getElementById('changePasswordForm').reset();-->
<!--        } catch (error) {-->
<!--            showAlert('error', error.message);-->
<!--        } finally {-->
<!--            setButtonLoading(button, false);-->
<!--        }-->
<!--    }-->

<!--    async function handleLogout() {-->
<!--        const refreshToken = localStorage.getItem('refreshToken');-->

<!--        try {-->
<!--            await apiCall(`/log-out?refreshToken=${refreshToken}`, 'POST');-->
<!--        } catch (error) {-->
<!--            console.error('Logout error:', error);-->
<!--        } finally {-->
<!--            localStorage.removeItem('accessToken');-->
<!--            localStorage.removeItem('refreshToken');-->
<!--            localStorage.removeItem('userData');-->
<!--            toggleForms('login');-->
<!--            showAlert('success', 'Logged out successfully!');-->
<!--            document.getElementById('changePasswordForm').reset();-->
<!--        }-->
<!--    }-->

<!--    function displayUserInfo() {-->
<!--        // In a real app, you would fetch user info from the backend-->
<!--        // For now, we'll display a placeholder-->
<!--        const userInfoDisplay = document.getElementById('userInfoDisplay');-->
<!--        const accessToken = localStorage.getItem('accessToken');-->

<!--        if (accessToken) {-->
<!--            // Decode JWT to get user email (basic decoding)-->
<!--            try {-->
<!--                const payload = JSON.parse(atob(accessToken.split('.')[1]));-->
<!--                userInfoDisplay.innerHTML = `-->
<!--                        <h3>Account Information</h3>-->
<!--                        <p>Email: <strong>${payload.sub || 'User'}</strong></p>-->
<!--                        <p>Status: <strong style="color: var(&#45;&#45;success);">Verified</strong></p>-->
<!--                    `;-->
<!--            } catch (error) {-->
<!--                userInfoDisplay.innerHTML = `-->
<!--                        <h3>Account Information</h3>-->
<!--                        <p>Your account is active and verified.</p>-->
<!--                    `;-->
<!--            }-->
<!--        }-->
<!--    }-->

<!--    // Check for verification token in URL-->
<!--    function checkVerificationToken() {-->
<!--        const params = new URLSearchParams(window.location.search);-->
<!--        const token = params.get('token');-->

<!--        if (token) {-->
<!--            verifyEmailToken(token);-->
<!--        }-->
<!--    }-->
<!--    function checkResetPasswordToken() {-->
<!--        const params = new URLSearchParams(window.location.search);-->
<!--        const token = params.get('token');-->

<!--        if (token) {-->
<!--            resetTokenFromUrl = token;-->
<!--            toggleForms('reset'); // ðŸ”¹ Reset password formunu gÃ¶stÉ™r-->
<!--        }-->
<!--    }-->



<!--    async function verifyEmailToken(token) {-->
<!--        try {-->
<!--            const response = await apiCall(`/verify-profile?token=${token}`, 'GET');-->
<!--            localStorage.setItem('accessToken', response.data.accessToken);-->
<!--            localStorage.setItem('refreshToken', response.data.token);-->

<!--            showAlert('success', 'Email verified! Redirecting to dashboard...');-->
<!--            setTimeout(() => {-->
<!--                toggleForms('dashboard');-->
<!--                displayUserInfo();-->
<!--            }, 1000);-->
<!--        } catch (error) {-->
<!--            showAlert('error', 'Verification failed: ' + error.message);-->
<!--        }-->
<!--    }-->

<!--    // Initialize on page load-->
<!--    document.addEventListener('DOMContentLoaded', function() {-->
<!--        const accessToken = localStorage.getItem('accessToken');-->

<!--        if (accessToken) {-->
<!--            toggleForms('dashboard');-->
<!--            displayUserInfo();-->
<!--        } else {-->
<!--            toggleForms('login');-->
<!--        }-->

<!--        checkVerificationToken();-->
<!--        checkResetPasswordToken();-->

<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #1e40af;
            --primary-light: #eff6ff;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
            'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
            sans-serif;
            background: linear-gradient(135deg, var(--primary-light) 0%, #f3f4f6 100%);
            min-height: 100vh;
            color: var(--gray-900);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--gray-900);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-900);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .alert {
            padding: 14px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            max-width: 500px;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
            box-shadow: var(--shadow-lg);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border-left: 4px solid var(--danger);
            box-shadow: var(--shadow-lg);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border-left: 4px solid var(--warning);
            box-shadow: var(--shadow-lg);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--gray-600);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--gray-700);
        }

        input, textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--gray-200);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: var(--gray-50);
            font-family: inherit;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .modal-actions button {
            flex: 1;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--gray-50);
            border-bottom: 2px solid var(--gray-200);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-700);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
            font-size: 14px;
            color: var(--gray-700);
        }

        tbody tr:hover {
            background: var(--gray-50);
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-600);
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray-600);
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--gray-700);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--primary);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
            }

            .header-actions button {
                flex: 1;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 12px 8px;
            }

            .modal-content {
                width: 95%;
            }

            .alert {
                min-width: auto;
                max-width: calc(100% - 40px);
                right: 20px;
                left: 20px;
                top: auto;
                bottom: 20px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Alerts -->
    <div class="alert alert-success" id="successAlert"></div>
    <div class="alert alert-error" id="errorAlert"></div>
    <div class="alert alert-warning" id="warningAlert"></div>

    <!-- Header -->
    <div class="header">
        <h1>Department Management</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="openCreateModal()">+ Create Department</button>
        </div>
    </div>

    <!-- Departments Table -->
    <div class="table-container">
        <div id="loadingIndicator" class="loading hidden">
            <div class="spinner"></div>
            <p>Loading departments...</p>
        </div>

        <div id="emptyState" class="empty-state hidden">
            <h3>No departments found</h3>
            <p>Create your first department to get started.</p>
        </div>

        <table id="departmentsTable" class="hidden">
            <thead>
            <tr>
                <th>Department ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Manager ID</th>
                <th>Employees</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="departmentsBody"></tbody>
        </table>
    </div>
</div>

<!-- Create/Edit Modal -->
<div id="departmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Create Department</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>

        <form id="departmentForm" onsubmit="handleSubmit(event)">
            <div class="form-group">
                <label for="deptName">Department Name *</label>
                <input type="text" id="deptName" placeholder="e.g., Engineering, Sales" required>
            </div>

            <div class="form-group">
                <label for="deptDescription">Description</label>
                <textarea id="deptDescription" placeholder="Brief description of the department (optional)"></textarea>
            </div>

            <div class="form-group">
                <label for="deptManagerId">Manager ID</label>
                <input type="number" id="deptManagerId" placeholder="Enter manager ID (optional)">
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Department</button>
            </div>
        </form>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080/api/v1/departments';
    let departments = [];
    let editingDepartmentId = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', loadDepartments);

    // Utility Functions
    function showAlert(type, message) {
        const alert = document.getElementById(`${type}Alert`);
        alert.textContent = message;
        alert.classList.add('show');
        setTimeout(() => alert.classList.remove('show'), 5000);
    }

    // async function apiCall(endpoint, method = 'GET', data = null) {
    //     try {
    //         const options = {
    //             method,
    //             headers: {
    //                 'Content-Type': 'application/json',
    //                 'Authorization': `Bearer ${localStorage.getItem('accessToken') || ''}`
    //             }
    //         };
    //
    //         if (data) {
    //             options.body = JSON.stringify(data);
    //         }
    //
    //         const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
    //
    //         // Handle non-JSON responses
    //         const contentType = response.headers.get('content-type');
    //         let responseData;
    //
    //         if (contentType && contentType.includes('application/json')) {
    //             responseData = await response.json();
    //         } else {
    //             responseData = await response.text();
    //         }
    //
    //         if (!response.ok) {
    //             throw new Error(typeof responseData === 'string' ? responseData : responseData.message || 'An error occurred');
    //         }
    //
    //         return responseData;
    //     } catch (error) {
    //         console.error('API Error:', error);
    //         throw error;
    //     }
    // }
    async function apiCall(endpoint, method = 'GET', data = null) {
        try {
            const headers = {
                'Content-Type': 'application/json'
            };

            const token = localStorage.getItem('accessToken');
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const options = {
                method,
                headers
            };

            if (data) {
                options.body = JSON.stringify(data);
            }

            const response = await fetch(`${API_BASE_URL}${endpoint}`, options);

            if (!response.ok) {
                const text = await response.text();
                throw new Error(text || response.statusText);
            }

            return response.status !== 204 ? await response.json() : null;
        } catch (error) {
            console.error('API Error:', error);
            throw error;
        }
    }


    // Load all departments
    async function loadDepartments() {
        try {
            showLoading(true);
            const data = await apiCall('/all');
            departments = data;
            renderDepartments();
        } catch (error) {
            showAlert('error', 'Failed to load departments: ' + error.message);
            showEmptyState();
        } finally {
            showLoading(false);
        }
    }

    // Render departments table
    function renderDepartments() {
        const tbody = document.getElementById('departmentsBody');
        const table = document.getElementById('departmentsTable');
        const emptyState = document.getElementById('emptyState');

        // ALWAYS reset UI state first
        emptyState.classList.add('hidden');
        table.classList.add('hidden');

        if (!departments || departments.length === 0) {
            emptyState.classList.remove('hidden');
            return;
        }

        tbody.innerHTML = departments.map(dept => `
        <tr>
            <td><span class="badge badge-info">${dept.id}</span></td>
            <td><strong>${dept.name}</strong></td>
            <td>${dept.description || '-'}</td>
            <td>${dept.managerId || '-'}</td>
            <td>
                <button class="btn btn-secondary btn-small"
                    onclick="viewEmployees(${dept.id})">
                    View Employees
                </button>
            </td>
            <td>
                <div class="actions">
                    <button class="btn btn-secondary btn-small"
                        onclick="openEditModal(${dept.id})">Edit</button>
                    <button class="btn btn-danger btn-small"
                        onclick="deleteDepartment(${dept.id})">Delete</button>
                </div>
            </td>
        </tr>
    `).join('');

        table.classList.remove('hidden');
    }

    // Open create modal
    function openCreateModal() {
        editingDepartmentId = null;
        document.getElementById('modalTitle').textContent = 'Create Department';
        document.getElementById('departmentForm').reset();
        document.getElementById('departmentModal').classList.add('show');
    }

    // Open edit modal
    async function openEditModal(deptId) {
        try {
            const data = await apiCall(`/get/${deptId}`);
            editingDepartmentId = deptId;
            document.getElementById('modalTitle').textContent = 'Edit Department';
            document.getElementById('deptName').value = data.name;
            document.getElementById('deptDescription').value = data.description || '';
            document.getElementById('deptManagerId').value = data.managerId || '';
            document.getElementById('departmentModal').classList.add('show');
        } catch (error) {
            showAlert('error', 'Failed to load department: ' + error.message);
        }
    }

    // Close modal
    function closeModal() {
        document.getElementById('departmentModal').classList.remove('show');
        editingDepartmentId = null;
        document.getElementById('departmentForm').reset();
    }

    // Handle form submission
    async function handleSubmit(event) {
        event.preventDefault();

        const formData = {
            name: document.getElementById('deptName').value,
            description: document.getElementById('deptDescription').value || null,
            managerId: document.getElementById('deptManagerId').value ? parseInt(document.getElementById('deptManagerId').value) : null
        };

        try {
            if (editingDepartmentId) {
                await apiCall(`/update/${editingDepartmentId}`, 'PUT', formData);
                showAlert('success', 'Department updated successfully');
            } else {
                await apiCall('/create', 'POST', formData);
                showAlert('success', 'Department created successfully');
            }
            closeModal();
            loadDepartments();
        } catch (error) {
            showAlert('error', 'Failed to save department: ' + error.message);
        }
    }

    // Delete department
    async function deleteDepartment(deptId) {
        if (!confirm('Are you sure you want to delete this department?')) {
            return;
        }

        try {
            await apiCall(`/delete/${deptId}`, 'DELETE');
            showAlert('success', 'Department deleted successfully');
            loadDepartments();
        } catch (error) {
            showAlert('error', 'Failed to delete department: ' + error.message);
        }
    }

    // View employees in department
    async function viewEmployees(deptId) {
        try {
            const employees = await apiCall(`/users/${deptId}`);

            if (employees.length === 0) {
                showAlert('warning', 'No employees in this department');
                return;
            }

            const employeeList = employees.map(emp =>
                `${emp.firstName} ${emp.lastName} (${emp.email})`
            ).join('\n');

            alert(`Employees in this department:\n\n${employeeList}`);
        } catch (error) {
            showAlert('error', 'Failed to load employees: ' + error.message);
        }
    }

    // UI Helpers
    function showLoading(show) {
        const loading = document.getElementById('loadingIndicator');
        const table = document.getElementById('departmentsTable');
        const emptyState = document.getElementById('emptyState');

        if (show) {
            loading.classList.remove('hidden');
            table.classList.add('hidden');
            emptyState.classList.add('hidden');
        } else {
            loading.classList.add('hidden');
        }
    }

    function showEmptyState() {
        document.getElementById('emptyState').classList.remove('hidden');
        document.getElementById('departmentsTable').classList.add('hidden');
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modal = document.getElementById('departmentModal');
        if (event.target === modal) {
            closeModal();
        }
    };
</script>

</body>
</html>